---
title: 计算机网络（三）
date: 2020-04-01 08:20:14
tags:
- 计算机网络
- 数据链路层
---
数据链路层所要考虑的是如何在不同的传输媒体间传输比特流。并且数据链路层在向上层提供服务时要尽可能屏蔽由于底层传输设备、实现手段的差异而带来的影响。
本章的主要内容：
* 数据链路层的点对点信道和广播信道的特点，以及这两种信道所使用的协议（`PPP`协议以及`CSMA/CD`协议）的特点。
* 数据链路层的三个基本功能：封装成帧、透明传输和差错检测。
* 以太网`MAC`层的硬件地址。
* 适配器、转发器、集线器、网桥、以太网交换机的作用和使用场合。
<!--- more --->
### 使用点对点信道的数据链路层
#### 数据链路和帧
**链路(link)** 是指一条无源的点到点的物理线路段，中间没有任何其他的交换结点。
**数据链路(data link)** 除了物理线路外，还必须有通信协议来控制这些数据的传输。若把实现这些协议的硬件和软件加到链路上，就构成了数据链路。
* 现在最常用的方法是使用适配器来实现这些协议的硬件和软件。
* 一般的适配器都包括了数据链路层和物理层这两层的功能。

网络适配器的别名：
* 通信适配器`adapter`
* 网络接口卡`NIC（Network Interface Card）`
* 网络接口板
* 网卡

**链路**也可以分为**物理链路**和**逻辑链路**。
物理链路即指链路。
逻辑链路即指数据链路。
早期的数据通信协议曾叫做通信规程**procedure**。

数据链路层的传输单位是帧`frame`

#### 数据链路层的基本功能
数据链路层的协议有许多种，但有一些基本问题是大家都需要考虑到的。
#### 1.封装成帧
封装成帧即在一段数据的前后分别添加首部和尾部，然后就构成了一个帧。
首部和尾部的一个重要作用就是进行**帧定界**。
![](https://Kylinnnnn.github.io/img/ComputerNetwork27.png)
帧定界可以定位数据部分的位置，从而方便接收端分辨哪些是数据哪些是控制信息。

通常**使用控制字符来实现帧定界**。
当数据是由可以打印的ASCII码组成的文本文件时，帧定界可以使用特殊的**帧定界符**。
在一个帧结构最前面的控制字符`SOH(Start Of Header)`表示帧的首部的开始。在帧结构最后面的控制字符`EOT(End Of Transmission)`表示帧的尾部的结束。
![](https://Kylinnnnn.github.io/img/ComputerNetwork28.png)
#### 2.透明传输
所谓“透明”，**表示某个实际存在的事物看起来像不存在一样**。而“在数据链路层透明传输数据”表示无论是怎样的数据，都能够没有差错地穿过数据链路层，也就是说数据链路层不能对传输的数据产生影响，数据链路层对于传输的数据应该是透明的。

在上述通过特殊字符能在通常情况下进行帧定界。但是，当帧的数据信息的二进制代码中出现恰好和`SOH`或`EOT`一样的内容时，数据链路层对于帧边界的判断就会出错。
![](https://Kylinnnnn.github.io/img/ComputerNetwork29.png)
那么此时数据链路层就没有实现透明传输功能。为了解决这个问题，采用了字节填充`(byte stuffing)`或称为字符填充`(character stuffing)`。

过程：
发送端的数据链路层在数据中出现的`SOH`和`EOT`之前都插入一个转义字符`ESC(十六进制编码为1B)`。
如果转义字符也在数据中，那在转义字符之前仍插入一个转义字符。
接收端的数据链路层在将数据送往网络层之前时删除`SOH`和`EOT`之前的转义字符，如果连续碰到两个转义字符，那就删除前一个。
由此在满足透明传输的条件下实现了帧定界。
![](https://Kylinnnnn.github.io/img/ComputerNetwork30.png)

**使用特殊比特进行帧定界**
比特填充过程：
发送方：报文中每出现连续的五个1就在后面插入一个0。
接收方：如果连续收到五个1，根据第六位进行判断，若为0，则将其删除；若为1并且第七为0，则表示帧结束，否则表示异常终止。
![](https://Kylinnnnn.github.io/img/ComputerNetwork31.png)
> 带下划线的0为填充位。
#### 3.差错检测
数据在传输的过程中可能出现比特差错：即1可能变成0，0可能变成1。
![](https://Kylinnnnn.github.io/img/ComputerNetwork32.png)

误码率`BER(Bit Error Rate)`：一段时间内，传输错误的比特占传输比特总数的比率。
误码率与信噪比有很大的关系。
为了保证数据传输的可靠性，在计算机网络传输数据时，必须要采取一些差错检测的措施。

常用的检错技术：
* 奇偶校验
* 循环冗余校验`CRC`

##### 奇偶校验
奇偶校验实际上是分成奇校验和偶校验两种，但大同小异。

奇偶校验就是在每一字节（8位）之外又增加了一位作为错误检测位。在某字节中存储数据之后，在其8个位上存储的数据是固定的，因为位只能有两种状态1或0，假设存储的数据用位标示为1、1、1、0、0、1、0、1，那么把每个位相加（1+1+1+0+0+1+0+1=5），结果是奇数。对于偶校验，校验位就定义为1；对于奇校验，则相反。如果传输数据的结果与标示位所代表的不一致，说明传输过程中出现了错误。

奇偶校验只能检测错误而并不能纠正错误。并且奇偶校验只能检测单位错误，不能检查出双位错误。

![](https://Kylinnnnn.github.io/img/ComputerNetwork33.png)
另外还有二维奇偶校验
![](https://Kylinnnnn.github.io/img/ComputerNetwork34.png)
二维奇偶校验相比于一维奇偶校验拥有了纠正单位错误的能力。

##### 循环冗余校验`CRC`
在发送端把数据划分为组，假定每组k个比特，在每组后面再添加供差错检测用的n位冗余码，然后一起发送出去。

冗余码的计算过程:在原数据M后面添加n个0得到的k + n位的数除以事先选定好的长度为n + 1位的除数P，余数是R，将n位的余数R作为冗余码。

在接收端对收到的每一帧进行CRC检验，即将k + n位的数除以P，余数为0则判定这个帧没有差错，否则表示存在差错。

缺点：只能检错不能纠错。仅用循环冗余检验CRC差错检测技术只能做到无差错接受和无比特差错，单纯使用CRC差错检测技术不能实现无差错传输或可靠传输。
![](https://Kylinnnnn.github.io/img/ComputerNetwork35.png)

### 点对点协议PPP
对于点对点的链路，目前使用最广泛的的数据链路层协议是点对点协议`PPP`(Point To Point Protocol)。
#### PPP协议的特点
PPP协议应满足的需求：
* 简单
* 封装成帧
* 透明传输
* 多种类型的链路
* 差错检测
* 多种网络层协议
* 检测连接状态
* 最大传送单元
* 网络层地址协商
* 数据压缩协商

PPP协议不需要的功能：
* 纠错
* 流量控制
* 序号
* 多点线路
* 半双工或单工链路

PPP协议的组成：
* 一个将IP数据报封装到串行链路的方法
* 链路控制协议`LCP(Link Control Protocol)`
* 网络控制协议`NCP(Network Control Protocol)`
#### PPP协议的帧格式
![](https://Kylinnnnn.github.io/img/ComputerNetwork36.png)

* PPP帧的首部和尾部分别为4个字段和2个字段
* 标志字段F = 0x7E(十六进制的7E的二进制表示是0111 1110)
* 地址字段A只置为0xFF。地址字段实际上并不起作用。
* 控制字段C通常置为0x03
* PPP面向字节的，所有的PPP帧的长度都是整数字节

**PPP的透明传输问题**
* 当PPP用在异步传输时，就使用一种特殊的字符填充法。
* 当PPP用在同步传输链路时，协议规定采用硬件来完成比特填充(和HDLC的做法一样)。
> HDLC：High-level Data Link Control。高级数据链路控制，也是数据链路层协议的一种，具体没了解。


在使用字符填充时，为了透明传输，需要对数据部分出现与协议标志位相同的字节部分进行处理。

![](https://Kylinnnnn.github.io/img/ComputerNetwork37.png)

* 将信息字段中出现的每一个0x7E字节转变称为2字节序列(0x7D,0x5E)。
* 若信息字段中出现一个0x7D字节，则将其转变成为2字节序列(0x7D,0x5D)。
* 若信息字段中出现ASCII码控制的字符(即数值小于0x20的字符)，则在该字符前面要加入一个0x7D字节，同时将该字符的编码加以改变(指加上0x20)。